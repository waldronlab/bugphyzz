---
title: "Data about Attributes and Sources"
output: 
  rmarkdown::html_vignette:
    toc: true
vignette: >
  %\VignetteIndexEntry{attributes}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>", 
  message = FALSE,
  warning = FALSE,
  echo = FALSE
)
```

```{r setup}
library(DT)
library(bugphyzz)
library(dplyr)
library(purrr)
```

```{r}
bp <- importBugphyzz(version = 'devel')
x <- map(bp, ~ {
  .x |> 
    select(Attribute, Attribute_source) |> 
    count(Attribute, Attribute_source, name = "N_annotations") |> 
    distinct()
}) |> 
  bind_rows() |> 
  filter(!is.na(Attribute_source)) |> # Attribute source with NAs means it was obtained through ASR or TAX
  relocate(Attribute_source, Attribute, N_annotations)
```

## Attributes

Ontology terms can be searched at [OSLv3](https://www.ebi.ac.uk/ols/index) and
[OSLv4](https://www.ebi.ac.uk/ols4).

```{r}
regex <- paste0(
  '(', paste(unique(x$Attribute), collapse = '|'), ');*'
)
fname <- system.file('extdata/attributes.tsv', package = 'bugphyzz')
attributes <- read.table(fname, header = TRUE, sep = '\t') |> 
  filter(grepl(regex, attribute_group))

colnames(attributes) <- c(
  'Attribute', 'Attribute group', 'Validity', 'Ontoloty', 'Description'
)
caption1 <- paste0(
  'Table 1. Attributes that could be found in bugphyzz.'
)
datt <- datatable(
  data = attributes, 
  filter = "top",
  extensions = c("Buttons","KeyTable"), 
  caption = htmltools::tags$caption(
    style = 'caption-side: top; text-align: left;',
    caption1
  ),
  options = list(
    dom = '<"top"B>lfrtip',
    buttons = list('copy', 'print'),
    iDisplayLength = 10,
    keys = TRUE,
    scrollX = TRUE,
    autoWidth = FALSE 
  )
)
datt
```

## Sources

```{r}
fname2 <- system.file(
  'extdata/attribute_sources.tsv', 
  package = 'bugphyzz', mustWork = TRUE
)
src <- read.table(
  fname2, header = TRUE, sep = '\t', quote = ""
)

xsrc <- left_join(x, src, by = 'Attribute_source') |> 
  rename(Full_source = full_source)
  
caption2 <- paste0(
  'Table 2. Sources of attribute annotations in bugphyzz. ',
  '* Evidence codes: exp = experimental evidence, igc = inferred from genomic context, ',
  'tas = traceable author statement, nas = non-traceable author statement; ',
  'more information at http://geneontology.org/docs/guide-go-evidence-codes/. ',
  '** The number in parenthesis indacates the number of annotations per',
  ' attribute group.'
)

src_dt <- datatable(
  data = xsrc, 
  filter = "top",
  extensions = c("Buttons","KeyTable"), 
  # caption = caption2,
  caption = htmltools::tags$caption(
    style = 'caption-side: top; text-align: left;',
    caption2
  ),
  options = list(
    dom = '<"top"B>lfrtip',
    buttons = list('copy', 'print'),
    iDisplayLength = 10,
    keys = TRUE,
    # scrollX = TRUE,
    autoWidth = TRUE
  )
)
src_dt
```

## Session info

```{r}
sessioninfo::session_info()
```


