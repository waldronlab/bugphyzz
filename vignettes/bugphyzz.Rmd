---
title: "bugphyzz"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{bugphyzz}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Introduction

The `bugphyzz` package provides access to an electronic resource of 
harmonized microbial annotations from different sources. The resource can
also be accessed by direct download at **>>> insert Zenodo link here <<<**.

# Import bugphyzz

```{r, message=FALSE, eval=FALSE}
if (!require("BiocManager", quietly = TRUE))
    install.packages("BiocManager")

## Devel version
BiocManager::install("waldronlab/bugphyzz")
```

```{r load package, message=FALSE}
library(bugphyzz)
library(dplyr)
library(purrr)
```

```{r import data}
bp <- importBugphyzz(version = 'devel', force_download = FALSE)
head(bp)
```

## Explore wich attribute groups are available

```{r}
unique(bp$Attribute_group)
```

## Explore which attribute signatures are available

```{r}
head(unique(bp$Attribute))
```

# Creating signatures

## Create signatures of taxids at the species level for aerophilicity

```{r}
aer <- bp[which(bp$Attribute_group == 'aerophilicity'),]
sigs1 <- getBugphyzzSignatures(
  df = aer, tax.id.type = 'NCBI_ID', tax.level = 'species', min.size = 10
)
map(sigs1, head)
```

## Create signatures of taxa names at the genus level for growth temperature
```{r}
gt <- bp[bp$Attribute_group == 'growth temperature', ]
sigs2 <- getBugphyzzSignatures(
  df = gt, tax.id.type = 'Taxon_name', tax.level = 'genus', min.size = 10
)
map(sigs2, head)
```
# Numeric attributes

Some attributes can be obtained with predefined labels or with numeric
values. An example is growth temperature, which we obtained as categorical labels
above (hyperthermophile, thermophile, psychrophile, mesophile). Let's get
the numeric values:

```{r}
gt_num <- importBugphyzzNumeric(version = 'devel', force_download = FALSE)[[1]]
df <- gt_num[gt_num$Attribute_value_min > 0 & gt_num$Attribute_value_max < 25,]
sigs3 <- getBugphyzzSignatures(
  df = gt_num, tax.id.type = 'NCBI_ID', tax.level = 'species'
)[[1]]
head(sigs3)
```

## Session information:

```{r}
sessioninfo::session_info()
```
